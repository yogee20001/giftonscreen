<!DOCTYPE html>
<html>
<head>
  <title>Preview</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="font-family:Arial;text-align:center;padding:20px;">

<h2>Preview</h2>

<p id="status">Checking preview status...</p>

<div id="content" style="display:none;">
  <p>⏳ This preview is valid for 1 hour only.</p>

  <!-- WhatsApp CTA will appear here -->
  <div id="whatsapp"></div>

  <br>
  <a id="unlockLink">Already have unlock code?</a>
</div>

<script>
const id = new URLSearchParams(location.search).get("id");

fetch("/api/get/" + id)
  .then(r => r.json())
  .then(d => {
    const now = Date.now();

    // Preview expired
    if (!d.unlocked && now > d.previewExpiresAt) {
      document.getElementById("status").innerText =
        "⛔ Preview expired. Please contact us on WhatsApp to unlock.";
      addWhatsAppButton();
      return;
    }

    // Preview active
    document.getElementById("status").innerText = "Preview Active";
    document.getElementById("content").style.display = "block";
    document.getElementById("unlockLink").href = "unlock.html?id=" + id;

    addWhatsAppButton();
  })
  .catch(() => {
    document.getElementById("status").innerText = "Invalid preview link.";
  });

function addWhatsAppButton() {
  const wa = document.createElement("a");
  wa.href =
    "https://wa.me/91XXXXXXXXXX?text=" +
    encodeURIComponent("I want to unlock my greeting. Preview ID: " + id);
  wa.target = "_blank";
  wa.innerText = "Contact on WhatsApp to Unlock";
  wa.style =
    "display:inline-block;margin-top:12px;padding:12px 18px;background:#25D366;color:white;text-decoration:none;border-radius:10px;font-weight:bold;";

  document.getElementById("whatsapp").innerHTML = "";
  document.getElementById("whatsapp").appendChild(wa);
}
</script>

</body>
</html>

